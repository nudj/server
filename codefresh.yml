version: '1.0'

steps:

  build_development:
    title: Build Development Image
    type: build
    image_name: nudj/server
    tag: development
    working_directory: ${{main_clone}}/development
    dockerfile: Dockerfile
    when:
      branch:
        only:
          - develop

  build_staging:
    title: Build Staging Image
    type: build
    image_name: nudj/server
    tag: staging
    working_directory: ${{main_clone}}/staging
    dockerfile: Dockerfile
    when:
      branch:
        only:
          - develop

  build_prod:
    title: Build Production Image
    type: build
    image_name: nudj/server
    tag: production
    working_directory: ${{main_clone}}/production
    dockerfile: Dockerfile
    when:
      branch:
        only:
          - master

  push_development:
    title: Push development
    type: push
    candidate: '${{build_development}}'
    tag: development
    credentials:
      username: '${{dockerUsername}}'
      password: '${{dockerPassword}}'
    when:
      branch:
        only:
          - develop

  push_staging:
    title: Push staging
    type: push
    candidate: '${{build_staging}}'
    tag: staging
    credentials:
      username: '${{dockerUsername}}'
      password: '${{dockerPassword}}'
    when:
      branch:
        only:
          - develop

  push_prod:
    title: Push production
    type: push
    candidate: '${{build_prod}}'
    tag: 1.2.0
    credentials:
      username: '${{dockerUsername}}'
      password: '${{dockerPassword}}'
    when:
      branch:
        only:
          - master
