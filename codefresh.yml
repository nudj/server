version: '1.0'

steps:

  build_demo:
    title: Build Demo Image
    type: build
    image_name: nudj/server
    tag: demo
    working_directory: ${{main_clone}}/demo
    dockerfile: Dockerfile
    when:
      branch:
        only:
          - develop

  build_staging:
    title: Build Staging Image
    type: build
    image_name: nudj/server
    tag: staging
    working_directory: ${{main_clone}}/staging
    dockerfile: Dockerfile
    when:
      branch:
        only:
          - develop

  build_prod:
    title: Build Production Image
    type: build
    image_name: nudj/server
    tag: production
    working_directory: ${{main_clone}}/production
    dockerfile: Dockerfile
    when:
      branch:
        only:
          - master

  push_demo:
    title: Push demo
    type: push
    candidate: '${{build_demo}}'
    tag: demo
    credentials:
      username: '${{dockerUsername}}'
      password: '${{dockerPassword}}'
    when:
      branch:
        only:
          - develop

  push_staging:
    title: Push staging
    type: push
    candidate: '${{build_staging}}'
    tag: staging
    credentials:
      username: '${{dockerUsername}}'
      password: '${{dockerPassword}}'
    when:
      branch:
        only:
          - develop

  push_prod:
    title: Push production
    type: push
    candidate: '${{build_prod}}'
    tag: 3.0.0
    credentials:
      username: '${{dockerUsername}}'
      password: '${{dockerPassword}}'
    when:
      branch:
        only:
          - master
